- name: Add the br_netfilter module
  modprobe:
    name: br_netfilter
    state: present

- name: systemctl net.bridge.bridge-nf-call-iptables
  sysctl:
    name: net.bridge.bridge-nf-call-ip6tables
    value: 1
    sysctl_file: /etc/sysctl.d/k8s.conf
    reload: yes
- name: systemctl net.bridge.bridge-nf-call-iptables
  sysctl:
    name: net.bridge.bridge-nf-call-iptables
    value: 1
    sysctl_file: /etc/sysctl.d/k8s.conf
    reload: yes

- name: install common packages
  apt:
    name:
      - python3-apt
      - software-properties-common

- name: add k8s apt-key
  apt_key: 
    url:  https://packages.cloud.google.com/apt/doc/apt-key.gpg 
    state: present


- name: Add kubernetes repo
  apt_repository:
    repo: deb https://apt.kubernetes.io/ kubernetes-xenial main
    state: present
    update_cache: yes